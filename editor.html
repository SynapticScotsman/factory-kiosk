<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Smart Factory - EDITOR</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto:wght@400;500;700&family=Montserrat:wght@400;500;700&family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f2f5; margin: 0; padding: 1rem; }
        .factory-container { position: relative; max-width: 1400px; width: 100%; margin: auto; border-radius: 1rem; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1); background: url('Artboard 1@4x.png') center/cover no-repeat; aspect-ratio: 1400/788; }
        .hotspot { position: absolute; width: 110px; height: 110px; border-radius: 50%; cursor: move; transform: translate(-50%, -50%); display: flex; flex-direction: column; justify-content: flex-end; align-items: center; text-align: center; color: white; font-weight: 600; line-height: 1.2; text-transform: uppercase; border: 2px solid rgba(255, 255, 255, 0.7); box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: transform 0.3s ease, box-shadow 0.3s ease; padding-bottom: 25px; box-sizing: border-box; user-select: none; }
        .hotspot:hover, .hotspot.selected { transform: translate(-50%, -50%) scale(1.05); box-shadow: 0 0 20px 5px #ffdd00; z-index: 10; }
        .hotspot-icon { position: absolute; width: 75px; height: 75px; top: -38px; left: 50%; transform: translateX(-50%); filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3)); pointer-events: none; }
        .hotspot-text { font-size: 0.8rem; }
        .hotspot.productivity { background-color: #4A90E2; }
        .hotspot.safety { background-color: #f56565; }
        .hotspot.quality { background-color: #ed64a6; }
        .hotspot.predictive-maintenance { background-color: #4a5568; }
        .hotspot::before { content: ''; position: absolute; top: 50%; left: 50%; width: 60px; height: var(--spotlight-length, 120px); z-index: -1; pointer-events: none; transform-origin: top center; transform: translateX(-50%) rotateZ(var(--spotlight-angle, 0deg)); clip-path: polygon(50% 0%, 0% 100%, 100% 100%); }
        .hotspot.productivity::before { background: linear-gradient(to bottom, rgba(74, 144, 226, 0.7) 0%, rgba(74, 144, 226, 0) 100%); }
        .hotspot.safety::before { background: linear-gradient(to bottom, rgba(245, 101, 101, 0.7) 0%, rgba(245, 101, 101, 0) 100%); }
        .hotspot.quality::before { background: linear-gradient(to bottom, rgba(237, 100, 166, 0.7) 0%, rgba(237, 100, 166, 0) 100%); }
        .hotspot.predictive-maintenance::before { background: linear-gradient(to bottom, rgba(74, 85, 104, 0.7) 0%, rgba(74, 85, 104, 0) 100%); }
        .editor-panel { position: fixed; bottom: 20px; right: 20px; background-color: rgba(45, 55, 72, 0.9); color: white; padding: 1.5rem; border-radius: 1rem; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 1000; width: 320px; backdrop-filter: blur(10px); max-height: calc(100vh - 40px); display: flex; flex-direction: column; }
        .editor-panel h3 { margin-top: 0; margin-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 0.5rem; }
        .editor-controls-scroll { overflow-y: auto; margin-bottom: 1rem; padding-right: 10px; }
        .editor-control { margin-bottom: 1rem; }
        .editor-control label { display: block; margin-bottom: 0.5rem; font-weight: 500; font-size: 0.9rem; }
        .editor-control select, .editor-control input, .editor-control textarea { width: 100%; padding: 0.5rem; border-radius: 6px; border: 1px solid rgba(255,255,255,0.2); background-color: rgba(0,0,0,0.2); color: white; box-sizing: border-box; }
        .editor-control textarea { min-height: 60px; resize: vertical; }
        .editor-control input[type="range"] { padding: 0; }
        .editor-buttons { display: flex; gap: 0.5rem; margin-top: auto; }
        #save-config-button, #add-hotspot-button, #delete-hotspot-button { background-color: #48bb78; color: white; border: none; padding: 0.75rem; border-radius: 8px; font-weight: 600; cursor: pointer; transition: background-color 0.2s ease; width: 100%; margin-top: 1rem; }
        #save-config-button:hover { background-color: #38a169; }
        #add-hotspot-button { background-color: #4299e1; }
        #add-hotspot-button:hover { background-color: #2b6cb0; }
        #delete-hotspot-button { background-color: #e53e3e; }
        #delete-hotspot-button:hover { background-color: #c53030; }
    </style>
</head>
<body>

    <main id="app-container">
        <div class="factory-container" id="factory-view">
            <!-- Hotspots will be generated by JavaScript -->
        </div>
    </main>
    
    <div class="editor-panel" id="editor-panel">
        <h3>Hotspot Editor</h3>
        <div class="editor-controls-scroll">
            <div id="editor-controls">
                <div class="editor-control">
                    <label for="hotspot-select">Select Hotspot</label>
                    <select id="hotspot-select"></select>
                </div>
                <hr style="border-color: rgba(255,255,255,0.2); margin: 1rem 0;">
                <div class="editor-control">
                    <label for="hotspot-title-input">Content Title</label>
                    <input type="text" id="hotspot-title-input">
                </div>
                <div class="editor-control">
                    <label for="hotspot-description-input">Full Description</label>
                    <textarea id="hotspot-description-input" rows="4"></textarea>
                </div>
                <div class="editor-control">
                    <label for="hotspot-media-input">Media Embed Code</label>
                    <textarea id="hotspot-media-input" rows="3"></textarea>
                </div>
                 <div class="editor-control">
                    <label for="hotspot-qrcode-input">QR Code Image URL</label>
                    <input type="text" id="hotspot-qrcode-input">
                </div>
                <hr style="border-color: rgba(255,255,255,0.2); margin: 1rem 0;">
                <div class="editor-control">
                    <label for="hotspot-text-input">Hotspot Label (use &lt;br&gt;)</label>
                    <input type="text" id="hotspot-text-input">
                </div>
                 <div class="editor-control">
                    <label for="hotspot-icon-select">Icon</label>
                    <select id="hotspot-icon-select">
                        <option value="eyelogo.png">Eye</option>
                        <option value="earlogo.png">Ear</option>
                    </select>
                </div>
                <div class="editor-control">
                    <label for="hotspot-font-select">Font</label>
                    <select id="hotspot-font-select">
                        <option value="Inter, sans-serif" style="font-family: 'Inter', sans-serif;">Inter</option>
                        <option value="Roboto, sans-serif" style="font-family: 'Roboto', sans-serif;">Roboto</option>
                        <option value="Montserrat, sans-serif" style="font-family: 'Montserrat', sans-serif;">Montserrat</option>
                        <option value="Poppins, sans-serif" style="font-family: 'Poppins', sans-serif;">Poppins</option>
                    </select>
                </div>
                <div class="editor-control">
                    <label for="spotlight-angle-slider">Spotlight Angle (deg)</label>
                    <input type="range" id="spotlight-angle-slider" min="-180" max="180" value="0">
                </div>
                <div class="editor-control">
                    <label for="spotlight-length-slider">Spotlight Length (px)</label>
                    <input type="range" id="spotlight-length-slider" min="50" max="300" value="120">
                </div>
            </div>
        </div>

        <div class="editor-buttons">
            <button id="add-hotspot-button">+ Add</button>
            <button id="delete-hotspot-button">- Delete</button>
        </div>
        <button id="save-config-button">Save & Download Config</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const factoryContainer = document.getElementById('factory-view');
            const hotspotSelect = document.getElementById('hotspot-select');
            
            const titleInput = document.getElementById('hotspot-title-input');
            const descriptionInput = document.getElementById('hotspot-description-input');
            const mediaInput = document.getElementById('hotspot-media-input');
            const qrCodeInput = document.getElementById('hotspot-qrcode-input');

            const textInput = document.getElementById('hotspot-text-input');
            const fontSelect = document.getElementById('hotspot-font-select');
            const iconSelect = document.getElementById('hotspot-icon-select');
            const angleSlider = document.getElementById('spotlight-angle-slider');
            const lengthSlider = document.getElementById('spotlight-length-slider');
            
            const saveButton = document.getElementById('save-config-button');
            const addButton = document.getElementById('add-hotspot-button');
            const deleteButton = document.getElementById('delete-hotspot-button');

            let hotspotData = [];
            let selectedHotspotElement = null;

            function createHotspots() {
                factoryContainer.innerHTML = '';
                hotspotSelect.innerHTML = '<option value="">-- Select a Hotspot --</option>';

                hotspotData.forEach((data, index) => {
                    const hotspot = document.createElement('button');
                    hotspot.className = `hotspot ${data.category}`;
                    hotspot.style.top = data.top;
                    hotspot.style.left = data.left;
                    hotspot.style.setProperty('--spotlight-angle', `${data.angle}deg`);
                    hotspot.style.setProperty('--spotlight-length', `${data.length}px`);
                    hotspot.style.fontFamily = data.font || 'Inter, sans-serif';
                    hotspot.dataset.index = index;
                    hotspot.innerHTML = `<img src="${data.icon || 'eyelogo.png'}" class="hotspot-icon"><div class="hotspot-text">${data.text}</div>`;
                    
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = data.title;
                    hotspotSelect.appendChild(option);
                    
                    factoryContainer.appendChild(hotspot);
                });
                
                addHotspotEventListeners();
            }

            function updateEditorPanel(index) {
                const data = hotspotData[index];
                if (!data) return;

                titleInput.value = data.title;
                descriptionInput.value = data.description;
                mediaInput.value = data.media;
                qrCodeInput.value = data.qrCode;
                textInput.value = data.text;
                fontSelect.value = data.font;
                iconSelect.value = data.icon;
                angleSlider.value = data.angle;
                lengthSlider.value = data.length;
            }

            function selectHotspot(index) {
                if (selectedHotspotElement) {
                    selectedHotspotElement.classList.remove('selected');
                }
                if (index === null || index === "") {
                    selectedHotspotElement = null;
                    document.getElementById('editor-controls').style.display = 'none';
                    return;
                }
                
                selectedHotspotElement = document.querySelector(`.hotspot[data-index='${index}']`);
                if (selectedHotspotElement) {
                    selectedHotspotElement.classList.add('selected');
                    hotspotSelect.value = index;
                    document.getElementById('editor-controls').style.display = 'block';
                    updateEditorPanel(index);
                }
            }

            function addHotspotEventListeners() {
                document.querySelectorAll('.hotspot').forEach(hotspot => {
                    hotspot.addEventListener('click', (e) => {
                        selectHotspot(e.currentTarget.dataset.index);
                    });

                    hotspot.addEventListener('mousedown', function(e) {
                        e.preventDefault();
                        selectHotspot(hotspot.dataset.index);
                        
                        const rect = factoryContainer.getBoundingClientRect();
                        document.onmousemove = function(moveEvent) {
                            let x = moveEvent.clientX - rect.left;
                            let y = moveEvent.clientY - rect.top;

                            x = Math.max(0, Math.min(x, rect.width));
                            y = Math.max(0, Math.min(y, rect.height));

                            const xPercent = (x / rect.width * 100);
                            const yPercent = (y / rect.height * 100);

                            hotspot.style.left = `${xPercent.toFixed(2)}%`;
                            hotspot.style.top = `${yPercent.toFixed(2)}%`;
                            
                            const data = hotspotData[hotspot.dataset.index];
                            if (data) {
                                data.left = `${xPercent.toFixed(2)}%`;
                                data.top = `${yPercent.toFixed(2)}%`;
                            }
                        };
                        document.onmouseup = () => {
                            document.onmousemove = null;
                            document.onmouseup = null;
                        };
                    });
                });
            }

            function applyChanges(index) {
                const data = hotspotData[index];
                const element = document.querySelector(`.hotspot[data-index='${index}']`);
                if (!data || !element) return;

                data.title = titleInput.value;
                data.description = descriptionInput.value;
                data.media = mediaInput.value;
                data.qrCode = qrCodeInput.value;
                data.text = textInput.value;
                data.font = fontSelect.value;
                data.icon = iconSelect.value;
                data.angle = angleSlider.value;
                data.length = lengthSlider.value;

                element.style.fontFamily = data.font;
                element.querySelector('.hotspot-icon').src = data.icon;
                element.querySelector('.hotspot-text').innerHTML = data.text;
                element.style.setProperty('--spotlight-angle', `${data.angle}deg`);
                element.style.setProperty('--spotlight-length', `${data.length}px`);

                hotspotSelect.options[parseInt(index) + 1].textContent = data.title;
            }

            hotspotSelect.addEventListener('change', () => selectHotspot(hotspotSelect.value));
            
            [titleInput, descriptionInput, mediaInput, qrCodeInput, textInput, fontSelect, iconSelect, angleSlider, lengthSlider].forEach(input => {
                input.addEventListener('input', () => {
                    if (selectedHotspotElement) {
                        applyChanges(selectedHotspotElement.dataset.index);
                    }
                });
            });

            addButton.addEventListener('click', () => {
                const newHotspotData = {
                    topic: "new-topic-" + Date.now(),
                    title: "New Hotspot",
                    description: "Full description goes here.",
                    media: "<iframe src='...' ></iframe>",
                    qrCode: "https://api.qrserver.com/...",
                    text: "New<br>Hotspot",
                    top: "50%", left: "50%",
                    angle: 0, length: 120, category: "productivity",
                    font: "Inter, sans-serif", icon: "eyelogo.png"
                };
                hotspotData.push(newHotspotData);
                createHotspots();
                selectHotspot(hotspotData.length - 1);
            });

            deleteButton.addEventListener('click', () => {
                if (selectedHotspotElement) {
                    const index = selectedHotspotElement.dataset.index;
                    hotspotData.splice(index, 1);
                    createHotspots();
                    selectHotspot(null);
                }
            });

            saveButton.addEventListener('click', () => {
                const configString = JSON.stringify(hotspotData, null, 2);
                localStorage.setItem('hotspotConfig', configString);
                
                const blob = new Blob([configString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'config.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                alert('Configuration saved to browser and downloaded as config.json!');
            });

            async function loadInitialConfig() {
                const savedConfig = localStorage.getItem('hotspotConfig');
                if (savedConfig) {
                    hotspotData = JSON.parse(savedConfig);
                } else {
                    try {
                        const response = await fetch('./config.json');
                        if (response.ok) {
                            hotspotData = await response.json();
                        } else {
                             throw new Error('config.json not found');
                        }
                    } catch(e) {
                        console.warn("config.json not found or invalid. Loading hardcoded default data.");
                        hotspotData = [
                            { topic: "agv", title: "AGV & SVG Tracking", description: "Full description...", media: "<iframe...>", qrCode: "...", text: "AGV & SVG<br>Tracking", top: "80%", left: "15%", angle: -45, length: 120, category: "productivity", icon: "eyelogo.png", font: "Inter, sans-serif" },
                            { topic: "vibration", title: "Vibration Measurement", description: "Full description...", media: "<iframe...>", qrCode: "...", text: "Vibration<br>Measurement", top: "50%", left: "40%", angle: -135, length: 120, category: "predictive-maintenance", icon: "earlogo.png", font: "Inter, sans-serif" }
                        ];
                    }
                }
                createHotspots();
            }

            loadInitialConfig();
        });
    </script>
</body>
</html>

