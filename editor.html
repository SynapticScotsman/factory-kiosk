<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Smart Factory - EDITOR</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto:wght@400;500;700&family=Montserrat:wght@400;500;700&family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f2f5; margin: 0; padding: 1rem; }
        .factory-container { position: relative; max-width: 1400px; width: 100%; margin: auto; border-radius: 1rem; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1); background: url('Artboard 1.png') center/cover no-repeat; aspect-ratio: 1400/788; }
        .hotspot { position: absolute; width: 110px; height: 110px; border-radius: 50%; cursor: pointer; transform: translate(-50%, -50%); display: flex; flex-direction: column; justify-content: flex-end; align-items: center; text-align: center; color: white; font-weight: 600; line-height: 1.2; text-transform: uppercase; border: 2px solid rgba(255, 255, 255, 0.7); box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: transform 0.3s ease, box-shadow 0.3s ease; padding-bottom: 25px; box-sizing: border-box; }
        .hotspot:hover, .hotspot.selected { transform: translate(-50%, -50%) scale(1.05); box-shadow: 0 0 20px 5px #ffdd00; }
        .hotspot-icon { position: absolute; font-size: 75px; top: -38px; left: 50%; transform: translateX(-50%); filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3)); pointer-events: none; line-height: 1; }
        .hotspot-text { font-size: 0.8rem; }
        .hotspot.productivity { background-color: #4A90E2; }
        .hotspot.safety { background-color: #f56565; }
        .hotspot.quality { background-color: #ed64a6; }
        .hotspot.predictive-maintenance { background-color: #4a5568; }
        .hotspot::before { content: ''; position: absolute; top: 50%; left: 50%; width: 60px; height: var(--spotlight-length); z-index: -1; pointer-events: none; transform-origin: top center; transform: translateX(-50%) rotate(var(--spotlight-angle)); clip-path: polygon(50% 0%, 0% 100%, 100% 100%); }
        .hotspot.productivity::before { background: linear-gradient(to bottom, rgba(74, 144, 226, 0.7) 0%, rgba(74, 144, 226, 0) 100%); }
        .hotspot.safety::before { background: linear-gradient(to bottom, rgba(245, 101, 101, 0.7) 0%, rgba(245, 101, 101, 0) 100%); }
        .hotspot.quality::before { background: linear-gradient(to bottom, rgba(237, 100, 166, 0.7) 0%, rgba(237, 100, 166, 0) 100%); }
        .hotspot.predictive-maintenance::before { background: linear-gradient(to bottom, rgba(74, 85, 104, 0.7) 0%, rgba(74, 85, 104, 0) 100%); }
        .editor-panel { position: fixed; bottom: 20px; right: 20px; background-color: rgba(45, 55, 72, 0.9); color: white; padding: 1.5rem; border-radius: 1rem; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 1000; width: 300px; backdrop-filter: blur(10px); }
        .editor-panel h3 { margin-top: 0; margin-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 0.5rem; }
        .editor-control { margin-bottom: 1rem; }
        .editor-control label { display: block; margin-bottom: 0.5rem; font-weight: 500; font-size: 0.9rem; }
        .editor-control select, .editor-control input { width: 100%; padding: 0.5rem; border-radius: 6px; border: 1px solid rgba(255,255,255,0.2); background-color: rgba(0,0,0,0.2); color: white; box-sizing: border-box; }
        .editor-control input[type="range"] { padding: 0; }
        #save-config-button { background-color: #48bb78; color: white; border: none; padding: 0.75rem; border-radius: 8px; font-weight: 600; cursor: pointer; transition: background-color 0.2s ease; width: 100%; margin-top: 1rem; }
        #save-config-button:hover { background-color: #38a169; }
    </style>
</head>
<body>

    <main id="app-container">
        <div class="factory-container" id="factory-view">
            <!-- Hotspots will be generated by JavaScript -->
        </div>
    </main>
    
    <div class="editor-panel" id="editor-panel">
        <h3>Hotspot Editor</h3>
        <div class="editor-control">
            <label for="hotspot-select">Select Hotspot</label>
            <select id="hotspot-select"></select>
        </div>
        <div class="editor-control">
            <label for="hotspot-text-input">Text (use &lt;br&gt; for new line)</label>
            <input type="text" id="hotspot-text-input">
        </div>
        <div class="editor-control">
            <label for="hotspot-font-select">Font</label>
            <select id="hotspot-font-select">
                <option value="Inter, sans-serif" style="font-family: 'Inter', sans-serif;">Inter</option>
                <option value="Roboto, sans-serif" style="font-family: 'Roboto', sans-serif;">Roboto</option>
                <option value="Montserrat, sans-serif" style="font-family: 'Montserrat', sans-serif;">Montserrat</option>
                <option value="Poppins, sans-serif" style="font-family: 'Poppins', sans-serif;">Poppins</option>
            </select>
        </div>
        <div class="editor-control">
            <label for="hotspot-top-slider">Vertical Position</label>
            <input type="range" id="hotspot-top-slider" min="0" max="100" value="50">
        </div>
        <div class="editor-control">
            <label for="hotspot-left-slider">Horizontal Position</label>
            <input type="range" id="hotspot-left-slider" min="0" max="100" value="50">
        </div>
        <div class="editor-control">
            <label for="spotlight-angle-slider">Spotlight Angle</label>
            <input type="range" id="spotlight-angle-slider" min="-180" max="180" value="0">
        </div>
        <div class="editor-control">
            <label for="spotlight-length-slider">Spotlight Length</label>
            <input type="range" id="spotlight-length-slider" min="50" max="300" value="120">
        </div>
        <button id="save-config-button">Save Configuration</button>
    </div>

    <script>
        const factoryContainer = document.getElementById('factory-view');
        
        // Initial data for hotspots. This will be the starting point.
        let hotspotData = [
            { topic: "agv", text: "AGV & SVG<br>Tracking", top: "60%", left: "12%", angle: -45, length: 120, category: "productivity", font: "Roboto, sans-serif" },
            { topic: "pick-place", text: "Pick & Place", top: "75%", left: "22%", angle: -45, length: 120, category: "productivity", font: "Montserrat, sans-serif" },
            { topic: "conveyor", text: "Conveyor Speed<br>Measurement", top: "70%", left: "60%", angle: -135, length: 120, category: "productivity", font: "Poppins, sans-serif" },
            { topic: "barcode", text: "Barcode<br>Localization", top: "68%", left: "75%", angle: -135, length: 120, category: "productivity", font: "Inter, sans-serif" },
            { topic: "area-monitoring", text: "Area<br>Monitoring", top: "48%", left: "28%", angle: 45, length: 120, category: "safety", font: "Roboto, sans-serif" },
            { topic: "spatter", text: "Spatter<br>Monitoring", top: "78%", left: "48%", angle: 180, length: 120, category: "safety", font: "Montserrat, sans-serif" },
            { topic: "fluid-dynamics", text: "Fluid Dynamics<br>Monitoring", top: "20%", left: "80%", angle: -135, length: 120, category: "safety", font: "Poppins, sans-serif" },
            { topic: "particle-size", text: "Particle Size<br>Monitoring", top: "30%", left: "60%", angle: -45, length: 120, category: "quality", font: "Inter, sans-serif" },
            { topic: "high-speed", text: "High-Speed<br>Counting", top: "50%", left: "88%", angle: -90, length: 120, category: "quality", font: "Roboto, sans-serif" },
            { topic: "vibration", text: "Vibration<br>Measurement", top: "35%", left: "45%", angle: 45, length: 120, category: "predictive-maintenance", font: "Montserrat, sans-serif" }
        ];

        // --- GUI Editor Logic ---
        const hotspotSelect = document.getElementById('hotspot-select');
        const textInput = document.getElementById('hotspot-text-input');
        const fontSelect = document.getElementById('hotspot-font-select');
        const topSlider = document.getElementById('hotspot-top-slider');
        const leftSlider = document.getElementById('hotspot-left-slider');
        const angleSlider = document.getElementById('spotlight-angle-slider');
        const lengthSlider = document.getElementById('spotlight-length-slider');
        const saveButton = document.getElementById('save-config-button');
        let selectedHotspot = null;
        let selectedHotspotData = null;

        function createHotspots() {
            factoryContainer.innerHTML = '';
            hotspotSelect.innerHTML = '';

            hotspotData.forEach((data, index) => {
                const hotspot = document.createElement('button');
                hotspot.className = `hotspot ${data.category}`;
                hotspot.style.top = data.top;
                hotspot.style.left = data.left;
                hotspot.style.setProperty('--spotlight-angle', `${data.angle}deg`);
                hotspot.style.setProperty('--spotlight-length', `${data.length}px`);
                hotspot.style.fontFamily = data.font || 'Inter, sans-serif';
                hotspot.dataset.index = index;
                hotspot.innerHTML = `<span class="hotspot-icon">üëÅÔ∏è</span><div class="hotspot-text">${data.text}</div>`;
                
                // Add to dropdown
                const option = document.createElement('option');
                option.value = index;
                option.textContent = data.text.replace('<br>', ' ');
                option.style.fontFamily = data.font || 'Inter, sans-serif';
                hotspotSelect.appendChild(option);
                
                factoryContainer.appendChild(hotspot);
            });
            
            // Re-add event listeners to new hotspot elements
            document.querySelectorAll('.hotspot').forEach(hotspot => {
                hotspot.addEventListener('click', (e) => {
                    const index = e.currentTarget.dataset.index;
                    hotspotSelect.value = index;
                    updateEditor(e.currentTarget);
                });
            });
        }

        function updateEditor(hotspot) {
            // Remove 'selected' class from all hotspots
            document.querySelectorAll('.hotspot').forEach(h => h.classList.remove('selected'));
            
            selectedHotspot = hotspot;
            selectedHotspot.classList.add('selected');
            const index = selectedHotspot.dataset.index;
            selectedHotspotData = hotspotData[index];
            
            textInput.value = selectedHotspotData.text;
            fontSelect.value = selectedHotspotData.font || 'Inter, sans-serif';
            topSlider.value = parseFloat(selectedHotspotData.top);
            leftSlider.value = parseFloat(selectedHotspotData.left);
            angleSlider.value = selectedHotspotData.angle;
            lengthSlider.value = selectedHotspotData.length;
        }

        hotspotSelect.addEventListener('change', () => {
            const selectedIndex = hotspotSelect.value;
            const hotspotElement = document.querySelector(`.hotspot[data-index='${selectedIndex}']`);
            updateEditor(hotspotElement);
        });

        textInput.addEventListener('input', () => {
            if (selectedHotspotData) {
                selectedHotspotData.text = textInput.value;
                selectedHotspot.querySelector('.hotspot-text').innerHTML = textInput.value;
                hotspotSelect.options[selectedHotspot.dataset.index].textContent = textInput.value.replace('<br>', ' ');
            }
        });

        fontSelect.addEventListener('change', () => {
            if (selectedHotspot) {
                const font = fontSelect.value;
                selectedHotspot.style.fontFamily = font;
                selectedHotspotData.font = font;
                hotspotSelect.options[selectedHotspot.dataset.index].style.fontFamily = font;
            }
        });

        topSlider.addEventListener('input', () => {
            if (selectedHotspot) {
                const top = topSlider.value;
                selectedHotspot.style.top = `${top}%`;
                selectedHotspotData.top = `${top}%`;
            }
        });

        leftSlider.addEventListener('input', () => {
            if (selectedHotspot) {
                const left = leftSlider.value;
                selectedHotspot.style.left = `${left}%`;
                selectedHotspotData.left = `${left}%`;
            }
        });

        angleSlider.addEventListener('input', () => {
            if (selectedHotspot) {
                const angle = angleSlider.value;
                selectedHotspot.style.setProperty('--spotlight-angle', `${angle}deg`);
                selectedHotspotData.angle = parseInt(angle);
            }
        });

        lengthSlider.addEventListener('input', () => {
            if (selectedHotspot) {
                const length = lengthSlider.value;
                selectedHotspot.style.setProperty('--spotlight-length', `${length}px`);
                selectedHotspotData.length = parseInt(length);
            }
        });
        
        saveButton.addEventListener('click', () => {
            const configString = JSON.stringify(hotspotData, null, 2);
            localStorage.setItem('hotspotConfig', configString);
            const blob = new Blob([configString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'config.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert('Configuration saved to browser storage and downloaded as config.json!');
        });

        // Initial setup
        createHotspots();
        if (hotspotData.length > 0) {
            updateEditor(document.querySelector('.hotspot'));
        }
    </script>
</body>
</html>
