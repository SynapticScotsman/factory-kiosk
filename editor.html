<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Smart Factory - EDITOR</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto:wght@400;500;700&family=Montserrat:wght@400;500;700&family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #e2e8f0; 
            margin: 0; 
            display: flex; 
            height: 100vh; 
            overflow: hidden; 
        }

        /* --- Main Layout --- */
        #editor-container {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            overflow: auto;
        }

        #control-panel {
            width: 350px;
            flex-shrink: 0;
            background-color: #fff;
            padding: 1.5rem;
            box-shadow: -5px 0 20px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
        }
        
        /* --- Factory View --- */
        .factory-container { 
            position: relative; 
            max-width: 1400px; 
            width: 100%; 
            margin: auto; 
            border-radius: 1rem; 
            overflow: hidden; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            background: url('Artboard 1@4x.png') center/cover no-repeat; 
            aspect-ratio: 1400/788; 
        }
        
        /* --- Hotspot Styles --- */
        .hotspot { position: absolute; width: 110px; height: 110px; border-radius: 50%; cursor: move; transform: translate(-50%, -50%); display: flex; flex-direction: column; justify-content: flex-end; align-items: center; text-align: center; color: white; font-weight: 600; line-height: 1.2; text-transform: uppercase; border: 2px solid rgba(255, 255, 255, 0.7); box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: transform 0.3s ease, box-shadow 0.3s ease; padding-bottom: 25px; box-sizing: border-box; user-select: none; }
        .hotspot:hover, .hotspot.selected { transform: translate(-50%, -50%) scale(1.05); box-shadow: 0 0 20px 5px #ffdd00; z-index: 10; }
        .hotspot-icon { position: absolute; width: 75px; height: 75px; top: -38px; left: 50%; transform: translateX(-50%); filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3)); pointer-events: none; }
        .hotspot-text { font-size: 0.8rem; }
        .hotspot.productivity { background-color: #4A90E2; }
        .hotspot.safety { background-color: #f56565; }
        .hotspot.quality { background-color: #ed64a6; }
        .hotspot.predictive-maintenance { background-color: #4a5568; }
        .hotspot::before { content: ''; position: absolute; top: 50%; left: 50%; width: 60px; height: var(--spotlight-length, 120px); z-index: -1; pointer-events: none; transform-origin: top center; transform: translateX(-50%) rotateZ(var(--spotlight-angle, 0deg)); clip-path: polygon(50% 0%, 0% 100%, 100% 100%); }
        .hotspot.productivity::before { background: linear-gradient(to bottom, rgba(74, 144, 226, 0.7) 0%, rgba(74, 144, 226, 0) 100%); }
        .hotspot.safety::before { background: linear-gradient(to bottom, rgba(245, 101, 101, 0.7) 0%, rgba(245, 101, 101, 0) 100%); }
        .hotspot.quality::before { background: linear-gradient(to bottom, rgba(237, 100, 166, 0.7) 0%, rgba(237, 100, 166, 0) 100%); }
        .hotspot.predictive-maintenance::before { background: linear-gradient(to bottom, rgba(74, 85, 104, 0.7) 0%, rgba(74, 85, 104, 0) 100%); }
        
        /* --- Control Panel Styles --- */
        #control-panel h2 { margin-top: 0; font-size: 1.5rem; color: #2d3748; border-bottom: 1px solid #e2e8f0; padding-bottom: 1rem; margin-bottom: 1.5rem; }
        .editor-controls-scroll { overflow-y: auto; height: 100%; padding-right: 1rem; }
        .control-group { margin-bottom: 1.25rem; }
        .control-group label { display: block; font-weight: 600; margin-bottom: 0.5rem; color: #4a5568; }
        .control-group input, .control-group select, .control-group textarea { width: 100%; padding: 0.5rem; border-radius: 8px; border: 1px solid #cbd5e0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        .control-group textarea { resize: vertical; min-height: 80px; }
        .control-group input[type="range"] { padding: 0; }
        .button-group { margin-top: auto; padding-top: 1.5rem; border-top: 1px solid #e2e8f0; display: flex; flex-wrap: wrap; gap: 0.5rem; }
        .button-group button, .button-group a { display: block; flex-grow: 1; padding: 0.75rem; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; text-align: center; text-decoration: none; box-sizing: border-box; transition: background-color 0.2s; }
        #add-hotspot { background-color: #3182ce; color: white; }
        #add-hotspot:hover { background-color: #2b6cb0; }
        #delete-hotspot { background-color: #e53e3e; color: white; }
        #delete-hotspot:hover { background-color: #c53030; }
        #save-config { background-color: #38a169; color: white; width: 100%; }
        #save-config:hover { background-color: #2f855a; }
        #back-to-view { background-color: #f7fafc; border: 1px solid #e2e8f0; color: #2d3748; width: 100%; margin-top: 0.5rem; }
        #back-to-view:hover { background-color: #e2e8f0; }
        #no-selection { text-align: center; color: #718096; margin-top: 2rem; }
    </style>
</head>
<body>

    <div id="editor-container">
        <div class="factory-container" id="factory-container">
            <!-- Hotspots will be generated by JavaScript -->
        </div>
    </div>

    <aside id="control-panel">
        <h2>Hotspot Editor</h2>
        <div class="editor-controls-scroll">
            <div id="hotspot-controls" style="display: none;">
                <div class="control-group">
                    <label for="hotspot-select">Selected Hotspot</label>
                    <select id="hotspot-select"></select>
                </div>
                <hr style="border-color: #e2e8f0; margin: 1rem 0;">
                <div class="control-group">
                    <label for="hotspot-title-input">Content Title</label>
                    <input type="text" id="hotspot-title-input">
                </div>
                <div class="control-group">
                    <label for="hotspot-description-input">Full Description</label>
                    <textarea id="hotspot-description-input" rows="4"></textarea>
                </div>
                <div class="control-group">
                    <label for="hotspot-media-input">Media Embed Code</label>
                    <textarea id="hotspot-media-input" rows="3"></textarea>
                </div>
                <hr style="border-color: #e2e8f0; margin: 1rem 0;">
                <div class="control-group">
                    <label for="hotspot-text-input">Hotspot Label (use &lt;br&gt;)</label>
                    <input type="text" id="hotspot-text-input">
                </div>
                 <div class="control-group">
                    <label for="hotspot-icon-select">Icon</label>
                    <select id="hotspot-icon-select">
                        <option value="eyelogo.png">Eye</option>
                        <option value="earlogo.png">Ear</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="hotspot-font-select">Font</label>
                    <select id="hotspot-font-select">
                        <option value="Inter, sans-serif" style="font-family: 'Inter', sans-serif;">Inter</option>
                        <option value="Roboto, sans-serif" style="font-family: 'Roboto', sans-serif;">Roboto</option>
                        <option value="Montserrat, sans-serif" style="font-family: 'Montserrat', sans-serif;">Montserrat</option>
                        <option value="Poppins, sans-serif" style="font-family: 'Poppins', sans-serif;">Poppins</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="spotlight-angle-slider">Spotlight Angle (deg)</label>
                    <input type="range" id="spotlight-angle-slider" min="-180" max="180" value="0">
                </div>
                <div class="control-group">
                    <label for="spotlight-length-slider">Spotlight Length (px)</label>
                    <input type="range" id="spotlight-length-slider" min="50" max="300" value="120">
                </div>
            </div>
            <div id="no-selection">
                <p>Click a hotspot to edit it, or add a new one.</p>
            </div>
        </div>

        <div class="button-group">
            <button id="add-hotspot">+ Add</button>
            <button id="delete-hotspot" style="display:none;">- Delete</button>
            <button id="save-config">üíæ Save & Download</button>
            <a href="index.html" id="back-to-view">‚Ü©Ô∏è View Page</a>
        </div>
    </aside>

    <script>
    document.addEventListener('DOMContentLoaded', async () => {
        const factoryContainer = document.getElementById('factory-container');
        const hotspotControls = document.getElementById('hotspot-controls');
        const noSelectionPanel = document.getElementById('no-selection');
        
        const hotspotSelect = document.getElementById('hotspot-select');
        const titleInput = document.getElementById('hotspot-title-input');
        const descriptionInput = document.getElementById('hotspot-description-input');
        const mediaInput = document.getElementById('hotspot-media-input');
        const textInput = document.getElementById('hotspot-text-input');
        const iconSelect = document.getElementById('hotspot-icon-select');
        const fontSelect = document.getElementById('hotspot-font-select');
        const angleSlider = document.getElementById('spotlight-angle-slider');
        const lengthSlider = document.getElementById('spotlight-length-slider');
        
        const addButton = document.getElementById('add-hotspot');
        const deleteButton = document.getElementById('delete-hotspot');
        const saveButton = document.getElementById('save-config');
        
        let hotspotData = [];
        let selectedHotspot = null;

        function renderHotspots() {
            factoryContainer.innerHTML = '';
            hotspotSelect.innerHTML = '<option value="">-- Select a Hotspot --</option>';

            hotspotData.forEach((data, index) => {
                const hotspotEl = document.createElement('div');
                hotspotEl.className = `hotspot ${data.category}`;
                hotspotEl.dataset.index = index;
                hotspotEl.style.left = data.left;
                hotspotEl.style.top = data.top;
                hotspotEl.style.setProperty('--spotlight-angle', `${data.angle}deg`);
                hotspotEl.style.setProperty('--spotlight-length', `${data.length}px`);
                hotspotEl.style.fontFamily = data.font;
                hotspotEl.innerHTML = `<img src="${data.icon}" class="hotspot-icon"><div class="hotspot-text">${data.text}</div>`;
                factoryContainer.appendChild(hotspotEl);

                const option = document.createElement('option');
                option.value = index;
                option.textContent = data.title;
                hotspotSelect.appendChild(option);
            });
            addEventListeners();
        }
        
        function updateEditorPanel(index) {
            const data = hotspotData[index];
            if (!data) return;
            titleInput.value = data.title || '';
            descriptionInput.value = data.description || '';
            mediaInput.value = data.media || '';
            textInput.value = data.text || '';
            iconSelect.value = data.icon || 'eyelogo.png';
            fontSelect.value = data.font || 'Inter, sans-serif';
            angleSlider.value = data.angle || 0;
            lengthSlider.value = data.length || 120;
        }

        function selectHotspot(index) {
            if (selectedHotspot) {
                selectedHotspot.classList.remove('selected');
            }
            if (index === null || index === "" || index === undefined) {
                selectedHotspot = null;
                hotspotControls.style.display = 'none';
                deleteButton.style.display = 'none';
                noSelectionPanel.style.display = 'block';
                return;
            }
            
            selectedHotspot = document.querySelector(`.hotspot[data-index='${index}']`);
            if (selectedHotspot) {
                selectedHotspot.classList.add('selected');
                hotspotSelect.value = index;
                hotspotControls.style.display = 'block';
                deleteButton.style.display = 'block';
                noSelectionPanel.style.display = 'none';
                updateEditorPanel(index);
            }
        }

        function addEventListeners() {
            document.querySelectorAll('.hotspot').forEach(hotspot => {
                hotspot.addEventListener('mousedown', function(e) {
                    e.preventDefault();
                    selectHotspot(hotspot.dataset.index);
                    const rect = factoryContainer.getBoundingClientRect();

                    document.onmousemove = function(moveEvent) {
                        let x = moveEvent.clientX - rect.left;
                        let y = moveEvent.clientY - rect.top;
                        x = Math.max(0, Math.min(x, rect.width));
                        y = Math.max(0, Math.min(y, rect.height));

                        const xPercent = (x / rect.width * 100).toFixed(2) + '%';
                        const yPercent = (y / rect.height * 100).toFixed(2) + '%';
                        
                        hotspot.style.left = xPercent;
                        hotspot.style.top = yPercent;

                        const data = hotspotData[hotspot.dataset.index];
                        if(data){
                           data.left = xPercent;
                           data.top = yPercent;
                        }
                    };
                    document.onmouseup = () => {
                        document.onmousemove = null;
                        document.onmouseup = null;
                    };
                });
            });
        }
        
        function applyChangesFromPanel(index) {
            const data = hotspotData[index];
            const element = document.querySelector(`.hotspot[data-index='${index}']`);
            if (!data || !element) return;

            data.title = titleInput.value;
            data.description = descriptionInput.value;
            data.media = mediaInput.value;
            data.text = textInput.value;
            data.icon = iconSelect.value;
            data.font = fontSelect.value;
            data.angle = angleSlider.value;
            data.length = lengthSlider.value;
            
            element.className = `hotspot selected ${data.category}`;
            element.style.fontFamily = data.font;
            element.querySelector('.hotspot-icon').src = data.icon;
            element.querySelector('.hotspot-text').innerHTML = data.text;
            element.style.setProperty('--spotlight-angle', `${data.angle}deg`);
            element.style.setProperty('--spotlight-length', `${data.length}px`);

            hotspotSelect.options[parseInt(index) + 1].textContent = data.title;
        }

        hotspotSelect.addEventListener('change', () => selectHotspot(hotspotSelect.value));
        
        [titleInput, descriptionInput, mediaInput, textInput, iconSelect, fontSelect, angleSlider, lengthSlider].forEach(input => {
            input.addEventListener('input', () => {
                if (selectedHotspot) {
                    applyChangesFromPanel(selectedHotspot.dataset.index);
                }
            });
        });

        addButton.addEventListener('click', () => {
            const newHotspotData = {
                topic: "new-topic-" + Date.now(), title: "New Hotspot", description: "Full description...", media: "<iframe>...</iframe>", 
                text: "New<br>Hotspot", top: "50%", left: "50%", angle: 0, length: 120, 
                category: "productivity", font: "Inter, sans-serif", icon: "eyelogo.png"
            };
            hotspotData.push(newHotspotData);
            renderHotspots();
            selectHotspot(hotspotData.length - 1);
        });

        deleteButton.addEventListener('click', () => {
            if (selectedHotspot) {
                hotspotData.splice(selectedHotspot.dataset.index, 1);
                createHotspots();
                selectHotspot(null);
            }
        });

        saveButton.addEventListener('click', () => {
            const configString = JSON.stringify(hotspotData, null, 2);
            localStorage.setItem('hotspotConfig', configString);
            
            const blob = new Blob([configString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'config.json';
            a.click();
            URL.revokeObjectURL(url);
            alert('Configuration saved to browser and downloaded as config.json!');
        });
        
        // --- CORRECTED Initial Load Logic ---
        const savedConfig = localStorage.getItem('hotspotConfig');
        if (savedConfig) {
            hotspotData = JSON.parse(savedConfig);
            renderHotspots();
        } else {
            fetch('./config.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('config.json not found, loading fallback.');
                    }
                    return response.json();
                })
                .then(data => {
                    hotspotData = data;
                    renderHotspots();
                })
                .catch(error => {
                    console.warn(error.message);
                    // Hardcoded default data as a final fallback
                    hotspotData = [
                        { "topic": "agv", "title": "AGV & SVG Tracking", "description": "Boost your logistical efficiency...", "media": "<iframe...>", "text": "AGV & SVG<br>Tracking", "top": "80%", "left": "15%", "angle": -45, "length": 120, "category": "productivity", "icon": "eyelogo.png", "font": "Inter, sans-serif" },
                        { "topic": "vibration", "title": "Vibration Measurement", "description": "Prevent downtime before it happens...", "media": "<iframe...>", "text": "Vibration<br>Measurement", "top": "50%", "left": "40%", "angle": -135, "length": 120, "category": "predictive-maintenance", "icon": "earlogo.png", "font": "Inter, sans-serif" }
                    ];
                    renderHotspots();
                });
        }
    });
    </script>
</body>
</html>

